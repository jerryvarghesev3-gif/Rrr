ll


private const val dosTarGzFileName = "firmware_imx6_d.tar.gz.enc"
private const val dynamoOsTarGzFileName = "firmware_imx6_dynamo.tar.gz.enc"  // ✅ add this

fun DextractYoctoVersion(targzFile: File): Outcome<String> {

    // ✅ Accept only OS tar files (DOS or Dynamo). Others are "not applicable"
    val isOsTar = (targzFile.name == dosTarGzFileName || targzFile.name == dynamoOsTarGzFileName)
    if (!isOsTar) {
        return Outcome.Error("NOT_OS_TAR")   // ✅ do NOT return "invalid input"
    }

    return when (val hillromVersion = searchTarGzFile(targzFile, "hillrom-version")) {
        is Outcome.Ok -> {
            val lines = hillromVersion.value.decodeToString()
                .split('\n')
                .map { it.trim() }

            val regex = Regex("\\d+(\\.\\d+)+")
            val match = lines.firstNotNullOfOrNull { line ->
                if (line.contains("Version:")) regex.find(line)?.value else null
            }

            if (match != null) Outcome.Ok(match)
            else Outcome.Error("Failed to decode os version.")
        }

        is Outcome.Error -> Outcome.Error(hillromVersion.error as String)
    }
}





when (val ver = DextractYoctoVersion(file)) {
    is Outcome.Ok -> {
        // existing parse logic
    }
    is Outcome.Error -> {
        if (ver.error == "NOT_OS_TAR") {
            // ✅ ignore
        } else {
            ProLog.e(MODULE_NAME, "Could not find yocto version in ${file.name}. Result: ${ver.error}")
            error = DFirmwareCompatibilityStatus.Error
        }
    }
}

