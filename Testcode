package com.connect.connection

import android.net.Uri
import android.os.Bundle
import android.widget.Button
import android.widget.ImageView
import android.widget.TextView
import androidx.appcompat.app.AppCompatActivity

class SummaryActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_summary)

        // --- Bind views ---
        val txtGateway   = findViewById<TextView>(R.id.txtGateway)
        val txtBed       = findViewById<TextView>(R.id.txtBed)
        val txtLocation  = findViewById<TextView>(R.id.txtLocation)
        val txtKlm       = findViewById<TextView>(R.id.txtKlm)
        val txtKlmStatus = findViewById<TextView>(R.id.txtKlmStatus)
        val imgPreview   = findViewById<ImageView>(R.id.imgPreview)   // only if in XML
        val btnVerifyKlm = findViewById<Button>(R.id.btnVerifyKlm)
        val btnDone      = findViewById<Button>(R.id.btnDone)

        // --- Read extras (from A/B/KLM activities) ---
        val gatewayId  = intent.getStringExtra(QRActivity.EXTRA_GATEWAY).orEmpty()
        val bedId      = intent.getStringExtra(QRActivity.EXTRA_BED).orEmpty()
        val locationId = intent.getStringExtra(QRActivity.EXTRA_LOCATION).orEmpty()
        val klmId      = intent.getStringExtra(QRKLMActivity.EXTRA_KLM_SCAN).orEmpty()
        val imageUri   = intent.getStringExtra(QRActivity.EXTRA_IMAGE_URI)?.let { Uri.parse(it) }

        // --- Show header values ---
        txtGateway.text  = "Gateway: $gatewayId"
        txtBed.text      = "Bed ID: $bedId"
        txtLocation.text = "Location ID: $locationId"

        if (klmId.isNotEmpty()) {
            txtKlm.text = "KLM ID: $klmId"
            txtKlmStatus.text = "KLM Status: Not verified"
        } else {
            txtKlm.text = "KLM ID: —"
            txtKlmStatus.text = "KLM Status: Not available"
        }

        // --- Show preview image if exists ---
        imageUri?.let { imgPreview.setImageURI(it) }

        // --- Verify button ---
        btnVerifyKlm.setOnClickListener {
            if (klmId.isNotEmpty()) {
                // later this is where you'll add MQTT / JSON verify logic
                txtKlmStatus.text = "KLM Status: Verified ✅"
            }
        }

        // --- Done button ---
        btnDone.setOnClickListener {
            finish() // Close SummaryActivity and go back
        }
    }

    override fun onDestroy() {
        super.onDestroy()
        // No heavy resources here → simple clean exit
    }
}
